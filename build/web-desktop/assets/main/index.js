System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Point.ts","./WinScreen.ts"],(function(t){var i,e,n,r,o,a,s,h,l,c,g,u,d,p,f,b,T;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.createClass,r=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,h=t.Prefab,l=t.Node,c=t.SpriteFrame,g=t.instantiate,u=t.Vec3,d=t.Sprite,p=t.UITransform,f=t.Component},function(t){b=t.Point},function(t){T=t.WinScreen}],execute:function(){var y,m,P,v,S,G,C,x,N,w,z,E,M,I,k,Y,W,A,V,R;a._RF.push({},"d71dd3kWftBq4fkarrsZVJS","GameManager",void 0);var H=s.ccclass,F=s.property,O=t("CellState",function(t){return t[t.EMPTY=0]="EMPTY",t[t.TIGER=1]="TIGER",t[t.GOAT=2]="GOAT",t}({}));t("GameManager",(y=H("GameManager"),m=F({type:h}),P=F({type:h}),v=F({type:h}),S=F({type:l}),G=F({type:l}),C=F({type:c}),x=F({type:c}),N=F(l),y(((R=function(t){function i(){for(var i,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return i=t.call.apply(t,[this].concat(n))||this,r(i,"tigerPrefab",E,o(i)),r(i,"goatPrefab",M,o(i)),r(i,"pointPrefab",I,o(i)),r(i,"boardNode",k,o(i)),r(i,"turnNotice",Y,o(i)),r(i,"goatTurnSprite",W,o(i)),r(i,"tigerTurnSprite",A,o(i)),r(i,"winScreen",V,o(i)),i.gridSize=5,i.spacingY=188,i.spacingX=188,i.tigerPositions=[[-2,2],[2,2],[-2,-2],[2,-2]],i.boardState=[],i.pointNodes=[],i.tigerCount=0,i.goatCount=0,i.dieGoat=0,i.isGoatTurn=!0,i.selectedTiger=null,i}e(i,t);var a=i.prototype;return a.onLoad=function(){null===i._instance?i._instance=this:this.node.destroy()},a.start=function(){this.validatePrefabs()&&(this.initializeBoardState(),this.spawnPoints(),this.spawnTigers(),this.calcuateTypePositions(O.EMPTY),this.hideWinScreen())},a.validatePrefabs=function(){return!!(this.tigerPrefab&&this.goatPrefab&&this.pointPrefab&&this.boardNode)||(console.warn("請確保所有必要的預製體和節點都已設定：tigerPrefab, goatPrefab, pointPrefab, boardNode"),!1)},a.initializeBoardState=function(){this.boardState=Array(5).fill(null).map((function(){return Array(5).fill(O.EMPTY)}))},a.spawnTigers=function(){var t=this;this.tigerPositions.forEach((function(i){var e=g(t.tigerPrefab),n=i[0],r=i[1],o=t.getWorldPositionFromGrid(n,r);e.setPosition(o),t.boardNode.addChild(e),e.name="tiger-"+(n+2)+"-"+(r+2),console.log("tiger",e.name),t.tigerCount++,t.boardState[r+2][n+2]=O.TIGER}))},a.spawnPoints=function(){var t=this,i=this.gridSize*this.spacingY,e=-i/2+this.spacingX/2,n=i/2-this.spacingY/2;this.pointNodes=Array(this.gridSize).fill(null).map((function(){return Array(t.gridSize).fill(null)}));for(var r=0;r<this.gridSize;r++)for(var o=0;o<this.gridSize;o++){var a=g(this.pointPrefab),s=e+o*this.spacingX,h=n-r*this.spacingY;a.setPosition(new u(s,h,0)),this.boardNode.addChild(a),a.name="point-"+o+"-"+r,this.pointNodes[r][o]=a;var l=a.getComponent("Point");l||(l=a.addComponent("Point")),a.on("point-clicked",this.onPointClicked,this)}},a.setTurn=function(t){this.resetHighlight();var i=this.turnNotice.getComponent(d);switch(t){case O.GOAT:i.spriteFrame=this.goatTurnSprite,this.isGoatTurn=!0,this.calcuateTypePositions(O.EMPTY);break;case O.TIGER:i.spriteFrame=this.tigerTurnSprite,this.isGoatTurn=!1,this.calcuateTypePositions(O.TIGER);break;case O.EMPTY:console.warn("GameManager::setTurn 傳參數錯誤!!!")}},a.getWorldPositionFromGrid=function(t,i){var e=this.gridSize*this.spacingY,n=-e/2+this.spacingX/2,r=e/2-this.spacingY/2;return new u(n+(t+2)*this.spacingX,r-(i+2)*this.spacingY,0)},a.onPointClicked=function(t){console.log("GameManager::onPointClicked",t.name);var i=t.name.split("-").map(Number),e=(i[0],i[1]),n=i[2];this.isGoatTurn?this.handleGoatTurn(t,e,n):this.handleTigerTurn(t,e,n)},a.handleGoatTurn=function(t,i,e){this.boardState[e][i]===O.EMPTY?this.placeGoat(t,i,e):console.log("該位置已經有棋子")},a.handleTigerTurn=function(t,i,e){this.selectedTiger&&this.boardState[e][i]!=O.TIGER?this.boardState[e][i]!=O.GOAT?this.moveTiger(t,i,e):console.log("目標位置已有棋子"):this.boardState[e][i]===O.TIGER&&(this.selectedTiger=this.boardNode.getChildByName("tiger-"+i+"-"+e),this.calculateTigerMovePositions(this.selectedTiger))},a.placeGoat=function(t,i,e){var n=g(this.goatPrefab);this.boardNode.addChild(n);var r=t.getWorldPosition(),o=this.boardNode.getComponent(p).convertToNodeSpaceAR(r);n.setPosition(o),n.name="goat-"+i+"-"+e,this.setupGoatComponents(n),this.boardState[e][i]=O.GOAT,n.setSiblingIndex(this.boardNode.children.length-1);var a=t.getComponent(b);a&&a.setPiece(O.GOAT),this.goatCount++,console.log("放置山羊成功，當前山羊數量：",this.goatCount),this.setTurn(O.TIGER),this.checkWinCondition()},a.setupGoatComponents=function(t){var i=t.getComponent(p);i||(i=t.addComponent(p)),i.setContentSize(80,80);var e=t.getComponent(d);e||(e=t.addComponent(d));var n=this.goatPrefab.data.getComponent(d);n&&n.spriteFrame?e.spriteFrame=n.spriteFrame:console.warn("無法獲取山羊圖片")},a.isValidPosition=function(t,i){var e,n;if((null==(e=this.boardState[i.y])?void 0:e[i.x])===O.EMPTY)return{x:i.x,y:i.y};if((null==(n=this.boardState[i.y])?void 0:n[i.x])===O.GOAT){var r,o={x:i.x,y:i.y};return i.x-t.x==1?o.x++:i.x-t.x==-1&&o.x--,i.y-t.y==1?o.y++:i.y-t.y==-1&&o.y--,(null==(r=this.boardState[o.y])?void 0:r[o.x])===O.EMPTY?o:null}return null},a.highlightIfValid=function(t,i){var e=this.isValidPosition(t,i);e&&this.setHighlight(e.x,e.y)},a.calculateTigerMovePositions=function(t){var i=t.name.split("-").map(Number),e=(i[0],i[1]),n=i[2],r={x:e,y:n};this.highlightIfValid(r,{x:e,y:n+1}),this.highlightIfValid(r,{x:e,y:n-1}),this.highlightIfValid(r,{x:e+1,y:n}),this.highlightIfValid(r,{x:e-1,y:n}),(e+n)%2==0&&(this.highlightIfValid(r,{x:e+1,y:n+1}),this.highlightIfValid(r,{x:e-1,y:n+1}),this.highlightIfValid(r,{x:e+1,y:n-1}),this.highlightIfValid(r,{x:e-1,y:n-1}))},a.calcuateTypePositions=function(t){this.resetHighlight();for(var i=0;i<this.boardState.length;i++)for(var e=0;e<this.boardState[i].length;e++)this.boardState[i][e]===t&&this.setHighlight(e,i)},a.setHighlight=function(t,i){var e=this.getPoint(t,i);if(e){var n=e.getComponent(b);n&&n.setHighlight(!0)}},a.resetHighlight=function(){for(var t=0;t<this.gridSize;t++)for(var i=0;i<this.gridSize;i++){var e=this.pointNodes[t][i];if(e){var n=e.getComponent(b);n&&n.setHighlight(!1)}}},a.moveTiger=function(t,i,e){var n=this.selectedTiger.name.split("-").map(Number),r=(n[0],n[1]),o=n[2],a=this.boardNode.getChildByName(this.selectedTiger.name);if(a){var s=t.getWorldPosition(),h=this.boardNode.getComponent(p).convertToNodeSpaceAR(s);a.setPosition(h),this.boardState[o][r]=O.EMPTY,this.boardState[e][i]=O.TIGER,a.name="tiger-"+i+"-"+e;var l=this.getPoint(r,o);if(l){var c=l.getComponent(b);c&&(c.setPiece(O.EMPTY),c.setHighlight(!1))}var g=t.getComponent(b);g&&(g.setPiece(O.TIGER),g.setHighlight(!1))}this.checkGoatCapture(r,o,i,e),this.selectedTiger=null,this.setTurn(O.GOAT)},a.checkWinCondition=function(){if(this.dieGoat>=5)this.showWinScreen(!0);else{for(var t=!0,i=0;i<this.gridSize;i++){for(var e=0;e<this.gridSize;e++){if(this.boardState[i][e]===O.TIGER)if(this.checkTigerHasValidMove(e,i)){t=!1;break}}if(!t)break}t&&this.showWinScreen(!1)}},a.checkTigerHasValidMove=function(t,i){var e={x:t,y:i},n=[{x:t,y:i+1},{x:t,y:i-1},{x:t+1,y:i},{x:t-1,y:i}];(t+i)%2==0&&n.push({x:t+1,y:i+1},{x:t-1,y:i+1},{x:t+1,y:i-1},{x:t-1,y:i-1});for(var r=0,o=n;r<o.length;r++){var a=o[r];if(this.isValidPosition(e,a))return!0}return!1},a.showWinScreen=function(t){var i=this.winScreen.getComponent(T);i&&i.showWinScreen(t)},a.hideWinScreen=function(){var t=this.winScreen.getComponent(T);t&&t.hideWinScreen()},a.checkGoatCapture=function(t,i,e,n){var r,o=(t+e)/2,a=(i+n)/2;if((null==(r=this.boardState[a])?void 0:r[o])===O.GOAT){var s="goat-"+o+"-"+a,h=this.boardNode.getChildByName(s);h&&(h.destroy(),this.boardState[a][o]=O.EMPTY,this.goatCount--,this.dieGoat++,console.log("老虎吃掉一隻羊！"),this.checkWinCondition())}},a.getPoint=function(t,i){return t>=0&&t<this.gridSize&&i>=0&&i<this.gridSize?this.pointNodes[i][t]:(console.warn("GameManager::getPoint::沒有抓到對應的point",t,i),null)},n(i,null,[{key:"instance",get:function(){return i._instance}}]),i}(f))._instance=null,E=i((z=R).prototype,"tigerPrefab",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=i(z.prototype,"goatPrefab",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=i(z.prototype,"pointPrefab",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=i(z.prototype,"boardNode",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=i(z.prototype,"turnNotice",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=i(z.prototype,"goatTurnSprite",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=i(z.prototype,"tigerTurnSprite",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=i(z.prototype,"winScreen",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=z))||w));a._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./GameManager.ts","./Point.ts","./WinScreen.ts"],(function(){return{setters:[null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/Point.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameManager.ts"],(function(e){var t,i,n,o,s,r,a,h,l,c,p,u,g,d,m,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.createClass,o=e.initializerDefineProperty,s=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,h=e.Node,l=e.BoxCollider2D,c=e.UITransform,p=e.Vec2,u=e.Button,g=e.Sprite,d=e.Input,m=e.Component},function(e){f=e.CellState}],execute:function(){var C,v,b,y,T;r._RF.push({},"91ad9cey8pGOotHl9hrnesr","Point",void 0);var E=a.ccclass,k=a.property;e("Point",(C=E("Point"),v=k(h),C((T=t((y=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,o(t,"highlight",T,s(t)),t.piece=null,t.sprite=null,t.highlightSprite=null,t.clickable=!0,t}i(t,e);var r=t.prototype;return r.start=function(){var e=this.getComponent(l);e||(e=this.addComponent(l));var t=this.getComponent(c);t&&(e.size=t.contentSize,e.offset=new p(0,0)),(this.getComponent(u)||this.addComponent(u)).node.on(h.EventType.TOUCH_END,this.onTouchEnd,this),this.sprite=this.getComponent(g),this.highlightSprite=this.sprite.spriteFrame},r.onTouchEnd=function(e){this.clickable&&this.node.emit("point-clicked",this.node)},r.setPiece=function(e){switch(e){case f.EMPTY:this.piece=null;break;case f.GOAT:var t=this.node.name.split("-").map(Number),i=(t[0],t[1]),n=t[2];this.piece=this.node.parent.getChildByName("goat-"+i+"-"+n);break;case f.TIGER:var o=this.node.name.split("-").map(Number),s=(o[0],o[1]),r=o[2];this.piece=this.node.parent.getChildByName("tiger-"+s+"-"+r)}},r.setHighlight=function(e){this.sprite&&(this.sprite.spriteFrame=e?this.highlightSprite:null),this.setClickable(e)},r.setClickable=function(e){this.clickable=e;var t=this.getComponent(u);t&&(t.enabled=e);var i=this.getComponent(l);i&&(i.enabled=e);var n=this.getComponent(c);n&&(n.enabled=e),this.node.off(d.EventType.TOUCH_END),e&&this.node.on(d.EventType.TOUCH_END,this.onTouchEnd,this)},n(t,[{key:"getPiece",get:function(){return this.piece}}]),t}(m)).prototype,"highlight",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=y))||b));r._RF.pop()}}}));

System.register("chunks:///_virtual/WinScreen.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,n,r,t,o,a,l,c,u,p,s,f;return{setters:[function(e){i=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,l=e.Node,c=e.Label,u=e.Sprite,p=e.SpriteFrame,s=e.director,f=e.Component}],execute:function(){var b,h,S,g,w,y,W,d,m,v,z,L,P;o._RF.push({},"9e27eyOEW5NoazMPhjnEuME","WinScreen",void 0);var F=a.ccclass,_=a.property;e("WinScreen",(b=F("WinScreen"),h=_(l),S=_(c),g=_(u),w=_(p),y=_(p),b((m=i((d=function(e){function i(){for(var i,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=e.call.apply(e,[this].concat(o))||this,r(i,"winPanel",m,t(i)),r(i,"winnerLabel",v,t(i)),r(i,"winner",z,t(i)),r(i,"tigerWinSprite",L,t(i)),r(i,"goatWinSprite",P,t(i)),i}n(i,e);var o=i.prototype;return o.hideWinScreen=function(){this.node.active=!1},o.showWinScreen=function(e){this.node.active=!0,this.winnerLabel.string=e?"老虎獲勝！":"山羊獲勝！",this.winner.spriteFrame=e?this.tigerWinSprite:this.goatWinSprite},o.onRestartClick=function(){this.hideWinScreen(),s.loadScene("main")},i}(f)).prototype,"winPanel",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=i(d.prototype,"winnerLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=i(d.prototype,"winner",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=i(d.prototype,"tigerWinSprite",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=i(d.prototype,"goatWinSprite",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=d))||W));o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});